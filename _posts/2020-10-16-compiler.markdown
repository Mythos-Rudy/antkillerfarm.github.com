---
layout: post
title:  lex&yacc, ANTLR
category: language 
---

* toc
{:toc}

# lex&yacc

2014.2

* 前言

春节期间，空闲时间较多，于是研究了一下lex和yacc的用法。知道lex和yacc，那还是大四学习编译原理那门课时候的事情了。转眼之间，那已经是十年前的事情了。

编译原理在整个大学期间的专业课中，属于难度比较高的课程。而且如果不是计算机专业的话，基本没有可能学到这门课。当时的课程作业是完成一个支持脚本绘图的软件。其难度即使以我现在的眼光来看，也颇不容易。当时只有少数人能够做出来，但基本上是参考教这门课的老师出的一本教辅书来写的。

这个课程作业之所以复杂，主要在于老师要求词法和语法的分析器都必须要自己编码。如果退一步，可以使用lex和yacc的话，就没有那么困难了。当然这也与大学里以传授理论为主的思想有关，我还是相当认同这一点的。

再顺便说一句，lex的作者之一是google的前CEO Eric Schmidt，这是他20岁时，在贝尔实验室的作品。当然，不全是他的功劳。实际上lex和yacc都是贝尔实验室的作品，这从lex效仿yacc的书写风格就能略见一斑。相比而言，yacc的地位和复杂度更为重要些。

* 前置条件

要想研究lex和yacc，除了需要有C语言的基础之外。还需要对正则式和BNF（Backus-Naur Form）有所了解。

* 教材

LEX & YACC TUTORIAL by Tom Niemann——这本书比较简练，且附有代码，入门级的极品

* 心得

lex生成的代码中，最重要的是yylex函数，该函数每匹配一个词，就返回一次。yacc生成的代码中，最重要的是yyparse函数，这个函数调用yylex函数以获得所需要的语法词汇。

lex的词法分析，依据用法的不同，可分为三类：

1）需要匹配识别的词汇。

2）需要过滤的词汇。一般是空白、TAB之类的分隔符。

3）直译的词汇。就是那些lex不处理，也不吃掉，而是直接交给yacc分析的词汇。

这三类词汇必须仔细规划，因为被解析的文本中，一旦出现不在上述三类的任何一类中的词汇时，程序就会报错。

yacc的BNF中一般都要包括类似下面的语句：

```c
stmt_list:
          stmt                  { }
        | stmt_list stmt        { }
        ;
```

其中stmt表示单个语句的语法目标，而stmt_list则是一系列语句的集合。

为什么要添加这一句呢？因为yacc在处理被解析的文本时，如果文本不能最终归结为一个单一的语法目标的时候，程序也会报错。

代码示例参见：

https://github.com/antkillerfarm/antkillerfarm_crazy/tree/master/mylex

这里使用的是lex/yacc在linux上现代版本——flex/bison。

# ANTLR

ANTLR—Another Tool for Language Recognition，其前身是PCCTS，它为包括Java，C++，C#,python在内的语言提供了一个通过语法描述来自动构造自定义语言的识别器（recognizer），编译器（parser）和解释器（translator）的框架。

官网：

http://www.antlr.org/

参考：

http://yuzhouwan.com/posts/55501/

Antlr

https://www.ibm.com/developerworks/cn/java/j-lo-antlr/index.html

使用Antlr开发领域语言

# MPS

MPS是jetbrains推出的用于构建DSL的工具。

官网：

https://www.jetbrains.com/mps/

# 物理+

顾静薇被安排和一名哲学教授去相亲。相亲对象非常浪漫，带她去看晚霞。

顾静薇：“他带我去看晚霞，我跟他讲，这是瑞利散射。他那个表情你是没有看见哦！”

https://mp.weixin.qq.com/s/RPkEHmI2soIsHvukUgpZDg

导演朱虹璇问气象科学家：为什么黄昏能看见红色的晚霞？

>顾静薇，或作顾静徽，1900～1983，女，物理学家。1920年入上海大同大学，成为胡刚复的学生。1923年考取留美公费生，入美国康奈尔大学文理学院。康奈尔大学本科（1926）+耶鲁大学硕士（1928）+密歇根大学博士（1931）。中国近代史上第一个物理学女性博士。先后执教于南开大学、大同大学、广西大学和北京钢铁学院。她和丈夫施汝为创办了中国科学院物理研究所，后者为所长。学生有吴健雄、郭永怀等。

过去玻璃窗的制作方法基本都是吹个球或者静置，但这种方法制作的玻璃基本都不平，所以那时的玻璃窗只能小块用木头框隔开。

----

英国皮尔金顿平板玻璃兄弟有限公司的阿拉斯塔、皮尔金顿于1952年在一次偶然的机会，看到一层油漂浮在水面上，该公司根据上述这一设想，发明了一种生产平板玻璃的革命性的方法-浮法工艺。它是因玻璃液漂浮在熔融的金属表面上获得抛光成型而得名的。

----

https://mp.weixin.qq.com/s/1PhFbQUUNJ4_kZB3Vc-y1w

物理学奖给黑洞，或许是因为错过了霍金

https://mp.weixin.qq.com/s/KD3IeebIsFEt0IlZTd4emA

89岁诺奖得主Roger Penrose，有一个令人咂舌的家族

https://mp.weixin.qq.com/s/JRWBEqgnLcr53D5T0C0U-Q

七位彭罗斯

https://mp.weixin.qq.com/s/tlu5kKHgIGFpkF5cnZZaUA

靠数学“拿了”两次诺贝尔奖，彭罗斯从“铺地砖”帮忙发现2011年化学奖的秘密

----

https://mp.weixin.qq.com/s/lB6dfjS5TAxjMndLCXMWgQ

憋住不放的屁最后去哪了？知道真相的我再也不忍屁了！

https://mp.weixin.qq.com/s/BIy4Ly3eIMOrXRbpjFRFYQ

男人最喜欢在家干的这件事，居然是在马桶上......

https://mp.weixin.qq.com/s/mDgnsn1xsI1WN3UhxPGPrQ

通过这些动图，让你秒懂高中物理原理!

https://mp.weixin.qq.com/s/2n-60v-ocfszU9xhbG4Ofg

达·芬奇和宋代画家告诉你，除了诗和远方，世上还有散射现象（瑞利散射、米氏散射）

https://mp.weixin.qq.com/s/foZaIzpyxiRf9_9O7f6EaQ

985大学首次登上Nature封面（超疏水材料）

https://mp.weixin.qq.com/s/hnDjc8H9US4vZM4PZADZYg

如何修建岩浆护城河

https://mp.weixin.qq.com/s/KsGGMCKsQlHYxXONOTthGQ

当你按下“除湿”键时，空调内究竟发生了什么？

https://mp.weixin.qq.com/s/fbJQs87R9c8_j_B5-zTsVg

古代没有冰箱，夏天冰块是怎么来的？

https://mp.weixin.qq.com/s/oweK30KIVInGK6wcFSRrTQ

三伏天，我在伊朗的风塔里惬意乘凉

https://mp.weixin.qq.com/s/Kfiz22KpxHtkQof3C5g81A

卡路里的身世变迁

https://mp.weixin.qq.com/s/b22vJHOrm_mOMa71TidN4w

八大数学预言

https://mp.weixin.qq.com/s/-4yzwG_LS1J_svR1CiOcpQ

一道闪电掉进海里，会电死多少鱼？

https://mp.weixin.qq.com/s/0CHFXs8IAxFIwvy7hOcnnw

不加色素做出彩虹色巧克力，科学家浪漫起来也太硬核了

https://mp.weixin.qq.com/s/GuXzR6Xf46ByomcVLzai3Q

干洗店用的一种东西，居然跟生命起源有关系？

https://mp.weixin.qq.com/s/ZxdeUFnkwfBH18hDrBDVcQ

为什么夏天更容易出轨？

https://mp.weixin.qq.com/s/dIJS9gebnqFh-nnaoosumA

科学家还是灭世者？记那些原子弹背后的人

https://mp.weixin.qq.com/s/iMIkyMxD5vr_iQU8cL7xSg

轻原子核中的宇称不守恒

https://mp.weixin.qq.com/s/cEGUr0kmP9UwlAoxgFuKGQ

想减肥么？要不把体重秤摆在树荫下试试？（光压）

https://mp.weixin.qq.com/s/IG4ViVlLuOwPlUzpliyKjg

谁统一了两种基本力？（Steven Weinberg）

https://mp.weixin.qq.com/s/bg9w0RGjUl0xIAu8Mjl57w

她是奠基“核裂变”理论的物理学家，却拒绝了曼哈顿计划（Lise Meitner）

https://mp.weixin.qq.com/s/2IZCvRo6YlBwsQwfDDMbxw

美国原子弹之父被骂了9年！最后他上台领奖，竟一把推开了总统......（Julius Robert Oppenheimer）

https://www.zhihu.com/answer/1525306973

10月15日《Nature》文章宣称首次在高压下实现室温超导，意味着什么？

https://mp.weixin.qq.com/s/IDvJP1XUVNGISSQuObgUzQ

人类首次实现室温超导，同行们为何评价不一？

https://mp.weixin.qq.com/s/HT2jrh-ICmkgTBFLEl0Qpw

从无量纲常数，到声速极限

https://mp.weixin.qq.com/s/9ym_nblmAzSiiEeIFJ346g

活了九十年十个月零两天的业余科学家，最伟大的显微镜制造者（Antonie Van Leeuwenhoek）

https://mp.weixin.qq.com/s/FAG0mFIimWQ875oeshpAOA

极短时间测量

https://mp.weixin.qq.com/s/sVyC5sBUEJLfAzetL0Fl-Q

什么是非平衡态热力学

# 世说新语++

## 2020.10（续）

张威本是关陇士族，家中财力雄厚。到任第一年，张威在青州哄抬萝卜收购价，忽悠全郡百姓都开始种萝卜；第二年，青州萝卜大丰收，张威却不再在市场上收购萝卜，直到把萝卜价格压到跳楼价才肯出手。

张威这局棋布了两年，终于以极低的价格在本郡收购了萝卜，又在外郡卖了个好价钱，确实捞了一票。

观张威所作所为，充其量也就是个奸商。这件事情被门下省的御史上奏给隋文帝，经门下省合议，判定张威有罪，愣是因此将张威一个堂堂“省部级干部”削职为民。隋文帝在诏书中责备张威：“我将一州之地交付给你，等于跟你赤心相见，你却不珍惜名声，不检视自己的行为，只会唯利是图。**你是执笏大臣，官人怎可争百姓之利？官家多一分利，百姓失一家血**，如此，天下人当如何看我？”

----

https://new.qq.com/omn/20201024/20201024A01TSJ00.html

清朝满洲的八旗由什么姓氏掌握？旗主又是怎么更迭的？

----

金戈铁马入东陵，壮士长干斩妖清。

弘历狗头悬碧树，慈禧犬尸喂苍鹰。

驱除鞑虏复中华，尽除螨虫荡膻腥。

至今神州犹传诵，考古当如孙殿英。

“考古专家”孙殿英之子“摸金校尉”孙天义，退休后留在陕西为黄帝墓守灵，任陕西省政协副主席，黄帝陵基金会会长。

明陵的地下结构复杂，墓道九曲十八弯，地宫虽然也位于中轴线上，但墓道却是蛇形的（孝陵，长陵，定陵皆如此），墓道口可能出现在圆形宝城墙的任意一个方向。这样一来，除非极其幸运，否则理论上只有挖出一条环绕宝城的环形探沟才能找到墓道口。

反观清陵就耿直得令人瞠目，几乎一个模子刻出来的：包括墓道在内，所有建筑都在中轴线，诚实得可怕。过了方城明楼就是哑巴院，墓道口就在哑巴院琉璃影壁下。

历代皇陵中，唐陵最为坚固，其次就是明陵。如果放到相同生产力水平下比较，清陵的施工质量甚至还不如西夏陵和北魏陵，所以逢盗必失也就不奇怪了。

https://zhuanlan.zhihu.com/p/265634690

为什么明朝皇陵没有一个被盗，而清朝皇陵却被大肆光顾
