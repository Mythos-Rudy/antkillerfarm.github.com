---
layout: post
title:  推荐系统的工程细节
category: AI 
---

# 推荐系统的工程细节

推荐系统不仅是算法，还包括若干工程细节。这些细节虽然不算复杂，够不上算法的层面，然而对产品的成败，却有举足轻重的作用。

## 一般架构

![](/images/article/suggest.png)

## 用户数据

用户自然特征：性别，年龄，地域，教育水平，出生日期，职业，星座

用户兴趣特征：兴趣爱好，使用网站，浏览/收藏内容，互动内容，品牌偏好，产品偏好

用户社会特征：婚姻状况，家庭情况，社交/信息渠道偏好

用户消费特征：收入状况，购买力水平，已购商品，购买渠道偏好，最后购买时间，购买频次

## 评价推荐质量

以今日头条类的新闻推荐为例，评估指标一般为：

1.平均转化率（点击量/曝光量）

2.人均阅读篇数（点击PV/点击UV）

3.平均阅读完成率

4.人均阅读时长（这个会受文章长度影响）

5.用户互动数据（评论、分享）

对评估指标的选取一般遵循以下原则：

1.用户满意度。

2.预测准确度。

3.覆盖率。

4.多样性。

5.新颖性。

6.惊喜度。

7.信任度。

8.实时性

9.鲁棒性

测试方法一般包括：

A/B测试、双盲交叉验证

需要思考的问题

1.新用户/新商品的冷启动问题。

2.马太效应问题。这在推荐算法中也叫做banana problem。原因是在美国这边的超市，几乎所有人都爱买banana，因为最便宜，也好吃也健康。所以过多的数据量可能会导致一个超市推荐算法疯狂推荐Banana给所有人。

PS：NLP领域的TF-IDF算法可有效防止马太效应问题。

按照道理来讲，推荐系统要做的事情其实是“推荐用户希望看到的东西”，但是“用户希望看到的东西”落实到指标上，可就让人头大了。

以新闻推荐为例。你说究竟要得到什么呢？

高CTR？那么擦边球的软色情以及热门文章就会被选出来。

高Staytime？那么视频+文章feed流就退化为视频feed流

高read/U？那么短文章就会被选出来。

exploration & exploitation，简单说，就是保证精准推荐的同时，进行兴趣探索。

一说大家都明白了，这不就是所有推荐系统做的最差的地方吗？我看了一个东西，就使劲出一个东西，App明明很多东西，我却越用越窄。

这个问题更加玄学，更加让人无奈。EE要不要做？

肯定要做，你不能让用户只能看到一类新闻，这样久了他的feed流只会越来越小，自己也觉得没劲，所以一定要做兴趣探索。

但是做，就势必牺牲指标，探索的过程是艰难的，大部分时间用户体验上也是负向的。

那么，牺牲多少ctr来保EE才算是合适的？EE的ROI什么时候算是>1的？怎么样确定EE的效果？EE要E到什么程度？

对于新业务线暂时不要以GMV为导向，可以从流量或转化率的角度入手，选取CTR作为核心指标；对于比较稳定的业务线则以GMV为导向，选取UV价值作为核心指标。

参考：

https://www.zhihu.com/question/26990692

类似今日头条这样的个性化推荐网站怎么评价推荐质量的优劣？

https://www.zhihu.com/question/19660417

为什么那么多牛人成天在研究讨论算法，系统自动推荐的东西还是不能令人满意呢？

https://mp.weixin.qq.com/s/EGorUTYz09PYU3CdU_qwDA

如何省时省力验证模型效果？达观数据在线分层实验平台给你支招

https://mp.weixin.qq.com/s/S9AjPkYLzRQpg5evyaoleQ

推荐系统的工程实现

https://mp.weixin.qq.com/s/cjo5MYa-t9tWDCjwDpkOeg

推荐系统评估

https://mp.weixin.qq.com/s/M0-TIuZBIYi4xGv5SkN6xw

利用高效率的补贴策略驱动用户增长

## 召回

这个词在推荐系统中至少有三个不同的含义：

1.recall。ML领域的查全率也称召回率。参见《机器学习（二十二）》。

2.match。指对大量的物品做一个初选，针对每一个用户形成个性化侯选集。

3.产品召回，流失客户召回。这个和通常汉语中意思一致，表示失而复得/得而复失。

## 术语

GMV(Gross Merchandise Volume)成交额

![](/images/article/pv.jpg)

CTR（Click-Through-Rate）即点击通过率，是互联网广告常用的术语，指网络广告（图片广告/文字广告/关键词广告/排名广告/视频广告等）的点击到达率，即该广告的实际点击次数除以广告的展现量。

RTB（Real Time Bidding，实时竞价）

eCPM（千次展示期望收入）

CPM（Cost per mille）

CPC（Cost per click）

CPA（Cost per action）

CPT（按展现时间收费）、CPL（按潜在线索收费）、CPS（按成功销售收费）

ROI（return on investment）投资回报率

$$同比=\frac{2010.12}{2009.12}$$

$$环比=\frac{2010.12}{2010.11}$$

## 数据埋点

数据埋点是数据产品经理、数据运营以及数据分析师，基于业务需求或产品需求对用户在应用内产生行为的每一个事件对应的页面和位置植入相关代码，并通过采集工具上报统计数据，以便相关人员追踪用户行为，推动产品优化或指导运营的一项工程。

参考：

https://zhuanlan.zhihu.com/p/53522063

数据产品经理需要掌握的产品埋点方法

## A/B Testing

https://mp.weixin.qq.com/s/fB3AFUiS4nFmqXpSnOpf4w

如何选择上班路线最省时间？从A/B测试数学原理说起

https://cn.udacity.com/course/ab-testing--ud257

A/B测试

https://exp-platform.com/2017abtestingtutorial/

A/B Testing

https://zhuanlan.zhihu.com/p/68509372

Netflix推荐系统模型的快速线上评估方法——Interleaving

https://mp.weixin.qq.com/s/gEET3mcI4VTLLg5ICQL2xQ

如何通过A/B测试实现用户有效增长？
